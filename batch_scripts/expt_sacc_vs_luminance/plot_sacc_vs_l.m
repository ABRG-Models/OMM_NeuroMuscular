% Load the data generated by sacc_vs_luminance.sh runs
r = struct();
rr = [];

thetax=0
thetay=-10

plottraj = 0;
if plottraj
    num_runs=6 % to show
    figure(33);
    clf;
end

colours = {'r','b','g','k','c','m','r--','b--','g--','k--','c--','m--'};
colcount = 1;
% Search files in results directory and select all:
flist = glob('results/r*.dat');
llen = size(flist)(1);
for i = [1 : llen]

    rnm = flist{i};
    resdatname = substr(rnm, 9); % strips initial 'results/' string
    resdatname = substr(resdatname, 1, size(resdatname)(2)-4); % Strips '.dat' off
    resdatname = strrep (resdatname, '.', 'p');
    resdatname = strrep (resdatname, '-', 'm');

    %rnm = ['results/' resname];
    display(['Loading file ' rnm])
    load (rnm); % loads struct variable called result

    r = struct_merge (r, result);

    if (size(result.(resdatname))(2) == 14)
        rr = [rr; result.(resdatname)];
    end

    % Also plot each trajectory from the model run data
    if plottraj
        for j=1:num_runs
            filepath=['/fastdata/' getenv('USER') '/oculomotorRX0RY' num2str(thetay) '_' num2str(i) '_' num2str(j)];
            if exist(filepath, 'dir') == 7
                A=load_ocm_min(filepath);
                figure(33);
                hold on;
                plot (A.eyeRy, colours{colcount})
            end
        end
    end
    colcount = colcount + 1;

end

% The rr array contains these columns:
% thetaX, thetaY, fix_lum, gap_ms, lumval, eyeRxAvg, eyeRyAvg, eyeRzAvg, eyeRxSD, eyeRySD, eyeRzSD, latmean, latsd, dopamine
%
% sort rr on luminance value
rr = sortrows(rr,5);

figure(32);
% rr(:,3) is lumval
errorbar (rr(:,3),rr(:,6),rr(:,9),'o-')

% Achieved position (Rot X)
figure(32);
errorbar (rr(:,5),rr(:,6),rr(:,9),'o-')
xlabel('Luminance');
ylabel('eyeRx');
legend(['TargX: ' num2str(rr(1,1)) ' TargY: ' num2str(rr(1,2))]);

% Achieved position (Rot Y)
figure(33);
errorbar (rr(:,5),rr(:,7),rr(:,10),'o-')
xlabel('Luminance');
ylabel('eyeRy');
legend(['TargX: ' num2str(rr(1,1)) ' TargY: ' num2str(rr(1,2))]);

% Achieved position (Rot Z)
figure(34);
errorbar (rr(:,5),rr(:,8),rr(:,11),'o-')
xlabel('Luminance');
ylabel('eyeRz');
legend(['TargX: ' num2str(rr(1,1)) ' TargY: ' num2str(rr(1,2))]);

% Latency
figure(35);
errorbar (rr(:,5),rr(:,12),rr(:,13),'o-')
xlabel('Luminance');
ylabel('Latency (ms)');
legend(['TargX: ' num2str(rr(1,1)) ' TargY: ' num2str(rr(1,2))]);